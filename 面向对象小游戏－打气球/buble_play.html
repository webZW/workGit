<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>æ‰“æ°”çƒğŸˆå°æ¸¸æˆ</title>
    <style>
        html,body{
            height: 100%;
            overflow: hidden;
            background-color: #ccc;
        }
        div{
            width: 250px;
            height: 333px;
            position: absolute;
            background: url(img/ballons.png) no-repeat;
            
        }
    </style>
</head>
<body>
    <h2 id='Allscore'></h2>
    <h2 id='time'></h2>
    <script>
        //é¢å‘å¯¹è±¡æŠ€æœ¯ï¼Œåˆ›å»ºæ°”çƒçš„æ„é€ å‡½æ•°
        function Ballon(){
            //åˆ—ä¸¾æ°”çƒçš„æ‰€æœ‰å±æ€§å’Œæ–¹æ³•ã€ç›‘å¬
            this.dom = null;
            this.x = null;
            this.y = null;
            //åˆ†æ•°
            this.score = null;

            //åˆå§‹åŒ–
            this.init();
            //ç»‘å®šäº‹ä»¶
            this.bindEvent();
            //æŠŠnewå‡ºæ¥çš„å¯¹è±¡å­˜æ”¾åœ¨å…¨å±€æ•°ç»„ä¸­ ä¾¿äºç®¡ç†
            Ballons.push(this);
        }

        //init() æ–¹æ³•
        Ballon.prototype.init = function(){
            //ä¸ŠDOMæ ‘
            this.dom = document.createElement("div");
            document.body.appendChild(this.dom);

            //åˆå§‹åŒ–x,y
            this.y = document.documentElement.clientHeight;
            this.x = parseInt(Math.random()*(document.documentElement.clientWidth - 250))
            this.dom.style.top = this.y+'px';
            this.dom.style.left = this.x+'px';

            //äº§ç”Ÿä¸€ä¸ªéšå³åˆ†æ•° 1~12åˆ†
            this.score=parseInt(Math.random()*12)+1;

            //æ˜¾ç¤ºå¯¹åº”åˆ†æ•°çš„æ°”çƒèƒŒæ™¯
            // 1 2 3 4 (0 -250 -250*2 -250*3) 0
            // 5 6 7 8 (0 -250 -250*2 -250*3) -333
            // 9 10 11 12 (0 -250 -250*2 -250*3) -333*2
            var cutX = -(this.score-1)%4 * 250;
            var cutY =  0;
            if(this.score>8){
                cutY = -333*2;
            }else if(this.score>4){
                cutY = -333;
            }

            this.dom.style.backgroundPosition = cutX+'px '+cutY+'px';

        }

        Ballon.prototype.update = function(){
            this.y -= this.score*4; //æ ¹æ®åˆ†æ•°æ”¹å˜æ°”çƒä¸Šå‡çš„é€Ÿåº¦
            if(this.y<-350){
                this.display();
            }
            this.dom.style.top = this.y+'px';

        }

        Ballon.prototype.display = function(){
            document.body.removeChild(this.dom); //DOMæ ‘ç§»é™¤å¯¹è±¡
            for(var i=0;i<Ballons.length;i++){
                if(this === Ballons[i]){
                    Ballons.splice(i,1); //åœ¨æ•°ç»„ç§»é™¤æ°”çƒ
                }
            }
        }

        //ç‚¹å‡»äº‹ä»¶è®¾ç½®
        Ballon.prototype.bindEvent = function(){

            var _this = this;
            this.dom.onclick = function(){
                scoreAll += _this.score
                _this.display();
            }
        }

        var time = document.getElementById('time');
        var Allscore = document.getElementById('Allscore');

        var Ballons = [];
        var scoreAll = 0;
        

        //æ¸¸æˆæ€»æ—¶é—´
        var allTime = 20;
        //å®šä¹‰å¸§æ•°
        var iframe = 0;

        var timer = setInterval(function(){
            iframe++;
            if(iframe%10 == 0){
                allTime--;
                if(allTime == 0){
                    clearInterval(timer);
                }
                //æ¯ç§’åˆ›å»º4ä¸ªæ°”çƒ
                for(var i=0;i<4;i++){
                    new Ballon();
                }
            }
            //è®©Ballonsé‡Œé¢çš„æ°”çƒæ›´æ–°ï¼Œç”¨update()
            Ballons.forEach((val,index)=>{
                val.update();
            })

            time.innerHTML = allTime;
            Allscore.innerHTML = scoreAll;
            
        },100)
    </script>
</body>
</html>